## 内存管理

不管什么样的编程语言，在代码的执行过程中都是需要给它给配内存的，有些需要我们自己手动的管理内存，有些可以自动帮我们管理内存

```js
Person P = new Person();
var obj = {name: "why"};

```

磁盘(代码从磁盘加载到内存)=> 内存 (由 CPU 执行内存中的代码)<= CPU
在执行过程中会继续在内存中开辟空间。

### 不管以什么样的方式管理内存，内存的管理都会有如下的生命周期

1. 分配申请你需要的内存（申请）；
2. 使用分配的内存（存放一些东西，比如对象等）；
3. **不需要使用时，对其进行释放**；

### 不同的编程语言对于第一步和第三步会有不同的实现

- 手动管理内存：比如 C、C++，包括早期的 OC，都是需要手动来管理内存的申请和释放（malloc 和 free 函数）
- 自动管理内存：比如 JAVA、JavaScript、Python、Swift、Dart 等，他们有自动帮助我们管理内存

## JS 的内存管理

- 会在**定义变量时**为我们分配内存
- 对于基本类型数据，分配内存时，直接在栈空间进行分配。对于复杂类型数据，分配内存时，在堆内存开辟一块空间，并且将这块空间的指针返回

## JS 垃圾回收

因为内存的大小是有限的，所以当内存不再需要的时候，我们需要对其进行释放，以便腾出更多的内存空间。

- 在手动管理内存的语言中，我们需要通过一些方式自己来释放不再需要的内存，比如 free 函数
  - 但是这种管理的方式其实非常低效， 影响我们编写代码的效率；
  - 并且这种方式对开发者的要求也很高，并且一不小心就会产生内存泄漏；
- 所以大部分现代的编程语言都是有自己的垃圾回收机制：
  - 垃圾回收的英文是 Garbage Collection，简称 GC
  - 对于哪些不再使用的对象，我们都称之为是垃圾，它需要被回收，以释放更多的内存空间
  - 而我们的语言运行环境，比如 Java 的运行环境 JVM，JavaScript 的运行环境 js 引擎都会有垃圾回收器
  - 垃圾回收器我们也会简称为 GC，所以在很多地方你看到 GC 其实指的是垃圾回收器

但是这里会出现另外一个关键的问题；**GC 怎么知道哪些对象不再使用了呢？**

- 这里就要用到 GC 的算法了。

### 常见的 GC 算法

1. 引用计数
   - 存在一个很大的弊端：循环引用
2. 标记清除
   - 算法设置一个根对象，垃圾回收期会定期从这个根开始，找所有从根开始有引用到的对象，对于那些没有引用到的对象，就认为是不可用的对象；
   - 这个算法可以很好的解决循环引用的问题；
   - JS 引擎比较广泛的采用的就是标记清除算法，当然类似于 V8 引擎为了进行更好的优化，它在算法的实现细节上也会结合一些其他的算法。
